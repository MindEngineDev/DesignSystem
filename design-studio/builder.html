<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Component Builder</title>
    <link rel="stylesheet" href="../../main.css" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- external theme CSS removed; using ../../main.css only -->
  </head>
  <body>
    <main class="container" x-data="builderApp()">
      <header class="ds-header">
        <div class="brand">Component Builder</div>
        <div class="controls">
          <sl-switch size="small" x-model="showDashboard">Show dashboard</sl-switch>
        </div>
      </header>

      <div class="grid-3">
        <aside class="panel">
          <h4>Components</h4>
          <ul class="nav-list">
            <template x-for="c in components" :key="c.id">
              <li><button @click="setActive(c.id)" x-text="c.label" class="btn" :class="{'active': activeId===c.id}"></button></li>
            </template>
          </ul>
        </aside>

        <section class="panel">
          <h4>Preview</h4>
          <div class="card" x-html="previewMarkup()"></div>
          <div style="margin-top: 0.5rem">
            <sl-button @click="openPreview()" size="small">Open preview</sl-button>
            <sl-button @click="copyMarkup()" size="small" variant="default">Copy HTML</sl-button>
          </div>
        </section>

        <aside class="panel">
          <h4>Controls</h4>
          <template x-for="ctrl in activeControls()" :key="ctrl.id">
            <div style="margin-bottom: 0.5rem">
              <label x-text="ctrl.label"></label>
              <template x-if="ctrl.type==='text'">
                <input type="text" x-model="controlValues[activeId][ctrl.id]" />
              </template>
              <template x-if="ctrl.type==='select'">
                <select x-model="controlValues[activeId][ctrl.id]">
                  <template x-for="opt in ctrl.options">
                    <option :value="opt.value" x-text="opt.label"></option>
                  </template>
                </select>
              </template>
              <template x-if="ctrl.type==='boolean'">
                <input type="checkbox" x-model="controlValues[activeId][ctrl.id]" />
              </template>
            </div>
          </template>
        </aside>
      </div>

      <section style="margin-top: 1rem">
        <h4>Raw markup</h4>
        <pre x-text="prettyMarkup()" style="white-space: pre-wrap"></pre>
      </section>
    </main>

    <script type="module" src="../app.js"></script>
    <script>
      // If builderApp isn't ready from app.js (e.g. dev path differences), fall back to window.builderApp
      document.addEventListener("alpine:init", () => {
        // Alpine will pick up the builderApp if defined globally by app.js
      });
    </script>
  </body>
</html>
